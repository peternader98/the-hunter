{% extends 'base.html' %}
{% block links %}
	<link rel="stylesheet" href="../static/css/alert-message.css">
{% endblock %}
{% block scripts %}
<script src="../static/js/alert-message.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.js" integrity="sha256-DrT5NfxfbHvMHux31Lkhxg42LY6of8TaYyK50jnxRnM=" crossorigin="anonymous"></script>
	<script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
    </script>
    <script>
		
		function shortStr(str){
			if(str.length > 12){
				return str.replace(str.substr(6, str.indexOf(".")-6) , " [..]")
			}
		}
       
        $(document).on('click','#upload',function(e){
			/*
            tinyMCE.triggerSave();
            e.preventDefault();
            $('#errors').hide();
            $('#errmsg').empty();
            $('#success').hide();
            $('#success-text').empty();

			*/
			
			
            var formdata = new FormData($('#file')[0]);
			if($("#input").val().trim() != ""){

			
            $.ajax({
                type:"POST",
                uri:"{{url_for('upload_file')}}",
                encrypt: 'multipart/form-data',
                data: formdata,
                processData: false,
                contentType: false,
                cache: false,
                success:function(data) {
					console.log(data)
                    if (data.status == true) {
						$("#file").trigger("reset");
						
						showMessage(data.status, data.msg)

                    }
                    if (data.status == false) {

						let strError = " "
						let strSuccess =  " "
						
						if(data.notAllowedFiles.length != 0 ){
							for(let errorFile of data.notAllowedFiles){
								strError = strError + shortStr(errorFile) + ", "
								
							}

							console.log("error files")
							console.log(strError)
						}

						if(data.allowedFiles.length != 0 ){
							for(let successFile of data.notAllowedFiles){
								strSuccess = strSuccess +  shortStr(successFile) + ", "
								
							}

							console.log("success files")
							console.log(strSuccess)
						}
						
						showMessage(false, "files"+ strSuccess +" is apploaded and those files"+ strError + "should be doc, docx  or pdf "   )
						$("#file").trigger("reset");
                    }
                },
                error:function (reject){

					var response = $.parseJSON(reject.responseText);
					console.log(reject)
					showMessage(false, "oh no, there is something whent wrong!!")
                }

			})
		}else{
			showMessage(false, "You need to upload at least 1 file.")
		}

        })
    </script>

	
{% endblock %}
{% block body %}

	{% include 'banner.html' %}
	{% include 'includes/alerts/messages.html' %}
	<div style="align-content: center;">
		<form id="file">
			<input id="input" type="file" name="files[]" multiple="true" autocomplete="off" required>
			
		</form >
		<button id="upload"> Plesae click me sempiy</button>
		
	</div>
{% endblock %}